#!/usr/bin/env bash
# This script configures Nginx to run as the nginx user
# and listen on all active IPs on port 8080

# Find the Nginx configuration file path
nginx_conf_path=$(find /etc -name nginx.conf 2>/dev/null | head -n 1)

# Find the default Nginx site configuration file path
default_site_conf_path=$(find /etc/nginx/conf.d -name default.conf 2>/dev/null | head -n 1)

# Check if configuration files are found
if [ -z "$nginx_conf_path" ] || [ -z "$default_site_conf_path" ]; then
    echo "Error: Nginx configuration files not found."
    exit 1
fi

# Replace nginx user in Nginx configuration
sed -i 's/user\s*nginx;/user nginx;/' "$nginx_conf_path"

# Replace default listening port in Nginx configuration
sed -i 's/listen\s*80;/listen 8080;/' "$default_site_conf_path"

# Restart Nginx for changes to take effect
service nginx restart
